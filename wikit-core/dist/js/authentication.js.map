{"version":3,"file":"./js/authentication.js","mappings":"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","sources":["webpack://wdg.authentication/external var \"wdg.config.authentication\"","webpack://wdg.authentication/external window [\"wp\",\"blockEditor\"]","webpack://wdg.authentication/external window [\"wp\",\"blocks\"]","webpack://wdg.authentication/external window [\"wp\",\"compose\"]","webpack://wdg.authentication/external window [\"wp\",\"components\"]","webpack://wdg.authentication/external window [\"wp\",\"coreData\"]","webpack://wdg.authentication/external window [\"wp\",\"data\"]","webpack://wdg.authentication/external window [\"wp\",\"editor\"]","webpack://wdg.authentication/external window [\"wp\",\"hooks\"]","webpack://wdg.authentication/external window [\"wp\",\"plugins\"]","webpack://wdg.authentication/./js/authentication.js"],"sourcesContent":["var __WEBPACK_NAMESPACE_OBJECT__ = wdg.config.authentication;","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"blockEditor\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"blocks\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"compose\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"components\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"coreData\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"editor\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"hooks\"];","var __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"plugins\"];","import gatedBlock from './blocks/gated-block.json';\nimport gatedIfBlock from './blocks/gated-if-block.json';\nimport gatedElseBlock from './blocks/gated-else-block.json';\nimport { status_key, restrictions_key, statuses, restrictions } from '@wdg/config/authentication';\nimport { InspectorControls, InnerBlocks, useInnerBlocksProps, useBlockProps } from '@wordpress/block-editor';\nimport { registerBlockType } from '@wordpress/blocks';\nimport { createHigherOrderComponent } from '@wordpress/compose';\nimport { PanelBody, Dashicon, RadioControl, ToggleControl } from '@wordpress/components';\nimport { useEntityProp } from '@wordpress/core-data';\nimport { useSelect, select, dispatch } from '@wordpress/data';\nimport { PluginDocumentSettingPanel } from '@wordpress/editor';\nimport { addFilter } from '@wordpress/hooks';\nimport { registerPlugin } from '@wordpress/plugins';\n\n/**\n * Control that outputs the configured authentication status and restrictions\n */\nfunction AuthenticationControl( {\n\tstatus = '',\n\tfilterStatus = null,\n\tonStatusChange,\n\trestriction = [],\n\tonRestrictionChange,\n} ) {\n\tlet options = Object.keys( statuses ).map( ( value ) => ( { value, label: statuses[ value ] } ) );\n\n\tif ( typeof filterStatus === 'function' ) {\n\t\toptions = options.filter( filterStatus );\n\t}\n\n\treturn (\n\t\t<div className=\"wdg-authentication-control\">\n\t\t\t<RadioControl\n\t\t\t\tlabel=\"Authentication Status\"\n\t\t\t\tclassName=\"wdg-authentication-control__status\"\n\t\t\t\tselected={ status }\n\t\t\t\toptions={ options }\n\t\t\t\tonChange={ onStatusChange }\n\t\t\t/>\n\n\t\t\t<br />\n\t\t\t<small className=\"wdg-authentication-control__label\">Authentication Restrictions</small>\n\n\t\t\t{ Object.keys( restrictions ).map( key => (\n\t\t\t\t<ToggleControl\n\t\t\t\t\tlabel={ restrictions[ key ].label }\n\t\t\t\t\tclassName=\"wdg-authentication-control__restriction\"\n\t\t\t\t\tkey={ key }\n\t\t\t\t\tdisabled={ status !== 'authenticated' }\n\t\t\t\t\tchecked={ restriction.includes( key ) }\n\t\t\t\t\tonChange={ checked => {\n\t\t\t\t\t\tif ( checked && ! restriction.includes( key ) ) {\n\t\t\t\t\t\t\tonRestrictionChange( [ ...restriction, key ] );\n\t\t\t\t\t\t} else if ( ! checked && restriction.includes( key ) ) {\n\t\t\t\t\t\t\tonRestrictionChange( restriction.filter( val => val !== key ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) ) }\n\t\t</div>\n\t);\n}\n\n/**\n * Save function for all authentication blocks\n */\nfunction save() {\n\treturn <InnerBlocks.Content />;\n}\n\n/**\n * Get the parent block and a function for setAttributes\n */\nfunction useSetParentAttributes( clientId ) {\n\tconst parents = select('core/block-editor').getBlockParents( clientId );\n\n\tif ( parents.length ) {\n\t\tconst parent = select('core/block-editor').getBlock( parents[ parents.length - 1 ] );\n\n\t\treturn function( attributes ) {\n\t\t\tdispatch( 'core/block-editor' ).updateBlock(\n\t\t\t\tparent.clientId,\n\t\t\t\t{\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\t...parent.attributes,\n\t\t\t\t\t\t...attributes,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\treturn null;\n}\n\n/**\n * wdg/gated\n */\nregisterBlockType(\n\tgatedBlock.name,\n\t{\n\t\t...gatedBlock,\n\t\tsave,\n\t\tedit: ( { attributes, setAttributes } ) => (\n\t\t\t<>\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody>\n\t\t\t\t\t\t<AuthenticationControl\n\t\t\t\t\t\t\tstatus={ attributes.status }\n\t\t\t\t\t\t\tfilterStatus={ status => status.value }\n\t\t\t\t\t\t\tonStatusChange={ status => setAttributes( { status } ) }\n\t\t\t\t\t\t\trestriction={ attributes.restrictions }\n\t\t\t\t\t\t\tonRestrictionChange={ restrictions => setAttributes( { restrictions } ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t\t<div { ...useInnerBlocksProps(\n\t\t\t\t\tuseBlockProps( { className: 'wdg-core-gated-block' } ),\n\t\t\t\t\t{\n\t\t\t\t\t\ttemplateLock: 'all',\n\t\t\t\t\t\ttemplate: [\n\t\t\t\t\t\t\t[ 'wdg/gated-if' ],\n\t\t\t\t\t\t\t[ 'wdg/gated-else' ],\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t) } />\n\t\t\t</>\n\t\t),\n\t}\n);\n\n/**\n * wdg/gated-if\n */\nregisterBlockType(\n\tgatedIfBlock.name,\n\t{\n\t\t...gatedIfBlock,\n\t\tsave,\n\t\tedit: ( { context, clientId } ) => {\n\t\t\tconst status              = context['wdg/gated/status'];\n\t\t\tconst restrictions        = context['wdg/gated/restrictions'];\n\t\t\tconst setParentAttributes = useSetParentAttributes( clientId );\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<InspectorControls>\n\t\t\t\t\t\t<PanelBody>\n\t\t\t\t\t\t\t<AuthenticationControl\n\t\t\t\t\t\t\t\tstatus={ status }\n\t\t\t\t\t\t\t\tfilterStatus={ status => status.value }\n\t\t\t\t\t\t\t\tonStatusChange={ status => setParentAttributes( { status } ) }\n\t\t\t\t\t\t\t\trestriction={ restrictions }\n\t\t\t\t\t\t\t\tonRestrictionChange={ restrictions => setParentAttributes( { restrictions } ) }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</PanelBody>\n\t\t\t\t\t</InspectorControls>\n\t\t\t\t\t<div {...useBlockProps( { className: \"wdg-core-gated-block__logic wdg-core-gated-block__logic--if\" } ) }>\n\t\t\t\t\t\t<div className=\"wdg-core-gated-block__header\">\n\t\t\t\t\t\t\t<Dashicon icon=\"unlock\" />\n\t\t\t\t\t\t\t<span className=\"wdg-core-gated-block__label\">If</span>\n\t\t\t\t\t\t\t<span className=\"wdg-core-gated-block__pill wdg-core-gated-block__pill--status\">\n\t\t\t\t\t\t\t\t{ status ? status : 'Public' }\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{ 'authenticated' === status && restrictions && restrictions.map( ( restriction ) => (\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tkey={ restriction }\n\t\t\t\t\t\t\t\t\tclassName=\"wdg-core-gated-block__pill wdg-core-gated-block__pill--restriction\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ restriction }\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div { ...useInnerBlocksProps(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclassName: 'wdg-core-gated-block__content',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttemplateLock: false,\n\t\t\t\t\t\t\t\ttemplate: [ [ 'core/paragraph' ] ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t) } />\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t);\n\t\t},\n\t}\n);\n\n/**\n * wdg/gated-else\n */\nregisterBlockType(\n\tgatedElseBlock.name,\n\t{\n\t\t...gatedElseBlock,\n\t\tsave,\n\t\tedit: ( { context, clientId } ) => {\n\t\t\tconst status              = context['wdg/gated/status'];\n\t\t\tconst restrictions        = context['wdg/gated/restrictions'];\n\t\t\tconst setParentAttributes = useSetParentAttributes( clientId );\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<InspectorControls>\n\t\t\t\t\t\t<PanelBody>\n\t\t\t\t\t\t\t<AuthenticationControl\n\t\t\t\t\t\t\t\tstatus={ status }\n\t\t\t\t\t\t\t\tfilterStatus={ status => status.value }\n\t\t\t\t\t\t\t\tonStatusChange={ status => setParentAttributes( { status } ) }\n\t\t\t\t\t\t\t\trestriction={ restrictions }\n\t\t\t\t\t\t\t\tonRestrictionChange={ restrictions => setParentAttributes( { restrictions } ) }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</PanelBody>\n\t\t\t\t\t</InspectorControls>\n\t\t\t\t\t<div {...useBlockProps( { className: \"wdg-core-gated-block__logic wdg-core-gated-block__logic--else\" } ) }>\n\t\t\t\t\t\t<div className=\"wdg-core-gated-block__header\">\n\t\t\t\t\t\t\t<Dashicon icon=\"lock\" />\n\t\t\t\t\t\t\t<span className=\"wdg-core-gated-block__label\">Else</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div { ...useInnerBlocksProps(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclassName: 'wdg-core-gated-block__content',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttemplateLock: false,\n\t\t\t\t\t\t\t\ttemplate: [ [ 'core/paragraph' ] ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t) } />\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\t}\n);\n\n/**\n * Register a plugin to edit the post level authentication settings\n */\nregisterPlugin(\n\t'wdg-core-authentication',\n\t{\n\t\trender: function AuthenticationPlugin() {\n\t\t\tconst currentPostType   = useSelect( select => select('core/editor').getCurrentPostType() );\n\t\t\tconst [ meta, setMeta ] = useEntityProp( 'postType', currentPostType, 'meta' );\n\n\t\t\tif ( ! meta ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<PluginDocumentSettingPanel\n\t\t\t\t\tname=\"wdg-authentication\"\n\t\t\t\t\tclassName=\"wdg-authentication\"\n\t\t\t\t\ttitle=\"Authentication\"\n\t\t\t\t\ticon=\"lock\"\n\t\t\t\t\tinitialOpen={ meta[ status_key ] }\n\t\t\t\t>\n\t\t\t\t\t<AuthenticationControl\n\t\t\t\t\t\tstatus={ meta[ status_key ] }\n\t\t\t\t\t\trestriction={ meta[ restrictions_key ] }\n\t\t\t\t\t\tonStatusChange={ status => setMeta( { ...meta, [ status_key ]: status } ) }\n\t\t\t\t\t\tonRestrictionChange={ restrictions => setMeta( { ...meta, [ restrictions_key ]: restrictions } ) }\n\t\t\t\t\t/>\n\t\t\t\t</PluginDocumentSettingPanel>\n\t\t\t);\n\t\t}\n\t}\n);\n\n/**\n * Filter block attributes to support authentication attributes and context\n */\naddFilter(\n\t'blocks.registerBlockType',\n\t'wdg/authentication/register',\n\tfunction registerBlockTypeAuthentication( settings, name ) {\n\t\tif ( typeof settings?.supports?.authentication === 'undefined' ) {\n\t\t\tsettings.supports = {\n\t\t\t\t...settings.supports,\n\t\t\t\tauthentication: true\n\t\t\t}\n\t\t}\n\n\t\tif ( settings?.supports?.authentication ) {\n\t\t\tsettings.attributes = {\n\t\t\t\t...settings.attributes,\n\t\t\t\t[ status_key ]: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdefault: '',\n\t\t\t\t\tenum: Object.keys( statuses ),\n\t\t\t\t},\n\t\t\t\t[ restrictions_key ]: {\n\t\t\t\t\ttype: \"array\",\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tenum: Object.keys( restrictions ),\n\t\t\t\t\t},\n\t\t\t\t\tdefault: [],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tsettings.usesContext = [\n\t\t\t...settings.usesContext ?? [],\n\t\t\t\"wdg/gated/context\",\n\t\t\t\"wdg/gated/restrictions\",\n\t\t];\n\n\t\treturn settings;\n\t}\n);\n\n/**\n * Add additional block controls to all blocks that supports authentication and don't have a parent authentication context\n */\naddFilter(\n\t'editor.BlockEdit',\n\t'wdg/authentication/edit',\n\tcreateHigherOrderComponent(\n\t\tfunction( BlockEdit ) {\n\t\t\treturn function( block ) {\n\t\t\t\tconst { attributes, setAttributes, isSelected, context } = block;\n\t\t\t\tconst supportsAuth = useSelect( ( select ) => select( 'core/blocks' ).getBlockSupport( block.name, 'authentication' ) );\n\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<BlockEdit {...block} />\n\n\t\t\t\t\t\t{ supportsAuth && ! context['wdg/gated/context'] && isSelected && (\n\t\t\t\t\t\t\t<InspectorControls>\n\t\t\t\t\t\t\t\t<PanelBody title=\"Block Authentication\" icon=\"lock\" initialOpen={ attributes[ status_key ] }>\n\t\t\t\t\t\t\t\t\t<AuthenticationControl\n\t\t\t\t\t\t\t\t\t\tstatus={ attributes[ status_key ] }\n\t\t\t\t\t\t\t\t\t\trestriction={ attributes[ restrictions_key ] }\n\t\t\t\t\t\t\t\t\t\tonStatusChange={ status => setAttributes( { [ status_key ]: status } ) }\n\t\t\t\t\t\t\t\t\t\tonRestrictionChange={ restrictions => setAttributes( { [ restrictions_key ]: restrictions } ) }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</PanelBody>\n\t\t\t\t\t\t\t</InspectorControls>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t'wdg/authentication/edit'\n\t),\n\t1\n);\n"],"names":["wdg","config","authentication","window","AuthenticationControl","_ref","status","filterStatus","onStatusChange","restriction","onRestrictionChange","options","Object","keys","statuses","map","value","label","filter","wp","element","createElement","className","RadioControl","selected","onChange","restrictions","key","ToggleControl","disabled","checked","includes","val","save","InnerBlocks","Content","useSetParentAttributes","clientId","parents","select","getBlockParents","length","parent","getBlock","attributes","dispatch","updateBlock","registerBlockType","gatedBlock","edit","_ref2","setAttributes","Fragment","InspectorControls","PanelBody","useInnerBlocksProps","useBlockProps","templateLock","template","gatedIfBlock","_ref3","context","setParentAttributes","Dashicon","icon","gatedElseBlock","_ref4","registerPlugin","render","currentPostType","useSelect","getCurrentPostType","meta","setMeta","useEntityProp","PluginDocumentSettingPanel","name","title","initialOpen","status_key","restrictions_key","addFilter","settings","supports","type","default","enum","items","usesContext","createHigherOrderComponent","BlockEdit","block","isSelected","supportsAuth","getBlockSupport"],"sourceRoot":""}